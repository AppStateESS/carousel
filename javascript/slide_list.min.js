
var carousel=new carousel;$(window).load(function(){Pagers.options({callback:loadCarousel,onRefresh:loadCarousel});loadCarousel()});function loadCarousel(){carousel.init()}function carousel(){var a=this;this.init=function(){$('[data-toggle="tooltip"]').tooltip({placement:"right"});this.initCreateButton();this.initEditClick();this.initSort();this.initFormUpdate();this.initHTMLCheck()};this.initFormUpdate=function(){$("#filepath").change(function(){var c=$(this).val();var d=$("#title").val();if(d.length==0){var b=c.replace(/^.*[\\\/]/,"");b=b.replace(/\.(png|jpg|jpeg|gif)$/i,"");b=b.replace(/_/," ");b=b.charAt(0).toUpperCase()+b.slice(1);$("#title").val(b)}})};this.initHTMLCheck=function(){$("#allowHtml").change(function(c){if(c.target.checked){CKEDITOR.replace("caption")}else{var b=CKEDITOR.instances.caption.getData();CKEDITOR.instances.caption.destroy(true);$("#caption").val(b)}})};this.initSort=function(){$("#sortable").sortable({placeholder:"ui-state-highlight",update:function(e,g){var d=g.item;var f=g.item.next("tr.pager-row");var c=d.data("rowId");var b=f.data("rowId");$.get("carousel/admin/",{command:"move_slide",move_id:c,next_id:b},"json").always(function(){Pagers.loadPagers();a.init()})}})};this.initCreateButton=function(){$("#delete-slide").hide();$("#new-slide").click(function(){console.log("wtf");$("#filepath").val("");$("#title").val("");$("#caption").val("");$("#url").val("");$("#resource-id").val(0);$("#slide-update").modal("show");$("#slide-update .modal-title").html("Create new slide")});$("#slide-update .save-slide").click(function(){$("#slide-form").submit()})};this.initEditClick=function(){$(".pager-row").click(function(c){if(!$(c.target).is("input.active-checkbox")){a.initDeleteClick();$("#delete-slide").show();var b=$(this).data("rowId");$("#resource-id").val(b);$("#slide-update").modal("show");$("#slide-update .modal-title").html("Update slide");$.get("carousel/admin/",{command:"edit_slide",slide_id:b},function(d){$("#title").val(d.title);$("#caption").val(d.caption);$("#url").val(d.url);$("#caption-zone-2").val(d.caption_zone);if(d.show_title==1){$("#show_title").prop("checked",true)}else{$("#show_title").prop("checked",false)}},"json")}});$(".active-checkbox").click(function(){if($(this).is(":checked")){$.get("carousel/admin/",{command:"activate",slide_id:$(this).data("slideId")})}else{$.get("carousel/admin/",{command:"deactivate",slide_id:$(this).data("slideId")})}})};this.initDeleteClick=function(){$("#delete-button").unbind();$("#delete-button .confirm").html("Delete slide");$("#delete-button").click(function(){$(".confirm",this).html("Click again to confirm deletion");$(document).click(function(b){if($(b.target).closest("#delete-button").length==0){$this.initDeleteClick()}});$("#delete-button").click(function(){$.get("carousel/admin/",{command:"delete_slide",slide_id:$("#resource-id").val()},function(b){window.location.reload()})})})}};